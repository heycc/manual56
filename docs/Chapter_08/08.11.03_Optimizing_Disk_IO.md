### 8.11.3. Optimizing Disk I/O

- 磁盘寻道是个巨大的性能瓶颈。当数据增长到非常大以致高效缓存变得不可使用时，这个问题将变得更加明显。对一个你或多或少随机访问的大的数据库系统，你可以确定你至少需要一次磁盘寻道来读，及多次磁盘定位来写。为最小化这个问题，使用低寻道时间的磁盘。
- 通过符号链接文件到不同磁盘上或者条纹磁盘来增加可用磁盘轴的数量（因此减小寻道开销）。
 - 使用符号链
 
        这意味着，对MyISAM表，你将索引文件和数据文件从它们在数据目录中的位置链接到其他的磁盘（同样可能是被条纹化）。这使寻道和读取时间都变快，假设磁盘没有被用作其他的目的。查看[Section 08.11.03.01, “Using Symbolic Links”][08.11.03.01]
 
 - 条带
        
        条带化意味着你有许多磁盘，将第一个块放在第一个磁盘上，第二个块放在第二个磁盘上，第N个块放在（N MOD number\_of_disks）盘上，等等。这意味着如果你的标准数据小于条带大小（准确说排成一线），你将获得更好性能。条带化非常依赖操作系统及条带大小，因此用不同的条带大小测试你的应用程序。查看[See Section 08.12.03, “Using Your Own Benchmarks”][08.12.03]
[08.11.03.01]: ./docs/Chapter_08/08.11.03_Using_Symbolic_Links.md#08.11.03.01
[08.12.03]: ./docs/Chapter_08/08.12.03_Using_Your_Own_Benchmarks.md
    条带化速度的区别非常依赖于参数。依赖于你如何设置条带参数和磁盘数，你可能会得到不同量级测量。你必须选择优化随机或者顺序访问。

- 对稳定性，你可能想使用RAID 0+1（条带加镜像），但是这种情况，你需要2 × N 驱动器容纳N驱动的数据。如果你经济允许这可能是最好的选择。然而，你还必须在某些卷管理软件上投资以更高效的处理。
- 一个好的选项是根据数据的重要程度变化RAID层。例如，将能重新生成的半重要数据存储在RAID 0 磁盘上，但是存储重要的数据，例如主机信息和日志存储在RAID 0+1或者RAID N上。如果你多次写，RAID N可能是个问题，由于更新奇偶位需要的时间。
- 在Linux上，你可以通过使用[hdparm](#)配置磁盘接口获取更好性能（在装载情况下通常达到100%）。下面的[hdparm](#)选项应该对MySQL非常好，并且可能对许多其他的应用：
 
        hdparm -m 16 -d 1
注意当使用这个命令，性能和可靠性依赖于你的硬件，因此我们强烈建议你使用[hdparm](#)后全面的测试你的系统。请翻阅[hdparm](#)参考手册获取更多信息。如果[hdparm](#)不是明智的使用，可能导致文件系统损坏，因此做任何事情之前需要备份。
- 你还可以设置数据库使用的文件系统参数：

    如果你不知道文件什么时间最后访问（在数据库服务上不是真实使用），你可以以选项[-o noatime](#)挂载你的文件系统。那跳过了更新文件系统中最后访问时间的索引节点，减少了一些磁盘寻道。

    在许多操作系统上，你可以设置文件系统异步更新，通过以[-o async](#)选项挂载。如果你的计算机相当稳定，这可以给你更好的性能而不需要牺牲太多可靠性。（这个标志在Linux上是缺省设置。）

####8.11.3.1. Using Symbolic Links
你可以将数据库或表从数据库目录移动到其他的位置，并且用符号链接替换它们到新的位置。你可能想这样做，例如，将数据库移动到具有更多自由空间的文件系统或者通过扩展你的表到不同的磁盘上增加你的系统速度。

对InnoDB表，在[CREATE TABLE](#)语句上使用[DATA DIRECTORY](#)替代符号链接，在[Section 05.04.01.02, “Specifying the Location of a Tablespace”][05.04.01.02]
这个新特征是支持跨平台的技术。

推荐的方式是链接整个数据库文件到不同的磁盘。链接MyISAM表仅仅做为最后的救助。

查看你的数据目录的位置，使用下面的语句：
    
    SHOW VARIABLES LIKE 'datadir';
[05.04.01.02]: ./docs/Chapter_05/05.04.01_Specifying_the_Location_of_a_Tablespace.md#05.04.01.02

#####8.11.3.1.1. Using Symbolic Links for Databases on Unix
在Unix上，符号链接一个数据库的方式是首先在有自由空间的磁盘上创建一个目录，然后从MySQL数据目录上创建一个软连接。

    shell> mkdir /dr1/databases/test 
    shell> ln -s /dr1/databases/test /path/to/datadir

MySQL不支持链接一个目录到多个数据库。用符号链接代替数据库目录有效，只要你没有在数据库间做链接。假设你在MySQL数据目录下有个数据库[db1](#)，然后做个指向[db1](#)的符号链接[db2](#)

    shell> cd /path/to/datadir
    shell> ln -s db1 db2

结果是，[db1](#)中的任何表[tbl_a](#)，那似乎在[db2](#)中存在一个表[tbl_a](#)。如果一个客户端更新[db1.tbl_a](#)，另外一个客户端更新[db2.tbl_a](#)，问题可能产生。
#####8.11.3.1.2. Using Symbolic Links for MyISAM Tables on Unix
符号链接仅对MyISAM表完全支持。对其他存储引擎的表文件，如果你试图使用符号链接你可能会得到奇怪的问题。对InnoDB表，使用在[Section 5.4.1.2, “Specifying the Location of a Tablespace”]中描述的技术作为替代。

不要在没有充分支持[realpath()](#)调用的系统上使用符号链接。（Linux和Solaris支持[realpath()](#)）。为确定你的系统是否支持符号链接，检查系统变量[have_symlink](#) [502]的值，使用下面语句：

    SHOW VARIABLES LIKE 'have_symlink';

MyISAM表符号链接的处理如下：

- 在数据目录，你通常有表格式（.frm）文件，数据（.MYD）文件，索引（.MYI）文件。数据文件盒索引文件可以被移动到任何地方，并且在数据目录处用符号链接代替。格式文件不行。
- 你可以独立的链接符号文件和索引文件到不同的目录。
- 为说明一个正在运行的MYSQL服务器如何完成符号链接，使用[ DATA DIRECTORY](#)和[INDEX DIRECTORY](#)选项创建表。查看[Section 13.01.17, “CREATE TABLE Syntax”][13.01.17]。其他的，如果[mysqld](#)没有运行，符号链接可以在命令行中手工使用[ln -s](#)完成。

**注意**
>数据目录或者索引目录的选项都没有包含在MYSQL数据库中。（Bug#31627）

- myisamchk不会用数据文件或者索引文件替代符号链接。她直接在符号链接指向的目录工作。任何临时文件创建在数据文件或者目录文件所在的目录。 [ALTER TABLE](#), [OPTIMIZE TABLE](#) 和 [REPAIR TABLE](#)语句的处理相同。

**注意**
>当你使用符号链接删除一个表时，符号链接和符号链接指向的数据文件都将被删除。这是一种非常好的原因，不以系统root用户或者允许的系统用户运行[mysqld](#)拥有MYSQL数据库目录的写访问

- 如果你使用[ALTER TABLE ... RENAME](#)或者[RENAME TABLE](#)重命名表，并且没有将表移动到其他的数据库，数据库目录中的符号链接被命名为新的名字且相关的数据文件和索引文件也被重命名。
- 如果你使用[ALTER TABLE ... RENAME](#)或者[RENAME TABLE](#)将一个表移动到其他数据库，表被移动到其他的数据库目录。如果表名修改了，数据库目录中的符号链接被命名为新的名字且相关的数据文件和索引文件也被重命名。
- 如果你没有使用符号链接，使用--skip-symbolic-links [455]选项启动[mysqld](#)，确保没人能在数据目录外面使用[mysqld](#)删除或重命名文件。

下面这些表链接操作不支持：
- 忽略数据目录和索引目录选项的[ALTER TABLE](#).
- 正如前面暗示的，仅数据文件盒索引文件能被符号链接。.frm文件不能被符号链接。试图这样做（例如，使一个表最为其他表的同义词）产生错误的结果。假设你在MySQL数据库目录下有一个数据库[db1](#)，一个表[tbl1](#)在数据库中，且你在[db1](#)目录中生成了一个指向[tbl1](#)的[tbl2](#)：

    shell> cd /path/to/datadir/db1 
    shell> ln -s tbl1.frm tbl2.frm 
    shell> ln -s tbl1.MYD tbl2.MYD 
    shell> ln -s tbl1.MYI tbl2.MYI
当一个线程读[db1.tbl1](#)，另外一个线程读[db1.tbl2](#)将会产生错误。

   - 查询缓存被欺骗（它没有方式知道tbl1没有被更新，因此它返回过期数据）。
   - [tbl2](#)表上的[alter]语句失败。
[13.01.17]: ./docs/Chapter_13/13.01.17_CREATE_TABLE_Syntax.md
#####8.11.3.1.3. Using Symbolic Links for Databases on Windows
在windows上，数据库目录能使用符号链接。这允许你将数据库目录放在不同的位置（例如，不同的磁盘上），这是通过设置一个符号链接完成的。在windows上使用符号链接与在Unix上相似，虽然设置链接的过程不同。

假设你想将一个名为[mydb](#)的数据库的数据库目录放置在[D:\data\mydb](#)。要做到这样，在mysql数据库上创建一个指向[D:\data\mydb](#)的符号链接。然而，在创建符号链接之前，确保[D:\data\mydb](#)目录存在，如果必要，创建它。如果你在数据库目录中已经存在一个名为[mydb](#)的数据库，将它移动到[D:\data](#)，否则符号链接将无效。为避免这个问题，当你移动数据库目录时确保数据库没有运行。

创建数据库符号链接的程序依赖于你的windows版本。

window vista，windows server 2008，或者新版本有自身的符号链接支持，因此你可以使用[mklink](#)命令创建个符号链接。这个命令需要管理员权限：

1.进入数据库目录：

    C:\> cd \path\to\datadir

2.在数据库目录中，创建一个名为[mydb](#)的符号链接指向数据库目录：

    C:\> mklink /d mydb D:\data\mydb

之后，所有在数据库[mydb](#)创建的表在D:\data\mydb处创建。

另外，在支持MYSQL的任何windows版本上，你可以通过在数据库目录中创建一个包含目的地址的.sym文件的符号链接。这个符号链接应该被命名为[db_name.sym](#)，[db_name](#)为数据库名。

windows上使用.sym文件支持数据库符号链接默认情况下打开。如果你不需要.sym文件符号链接，你可以--skip-symbolic-links [455]选项启动[mysqld](#)关闭符号链接的支持。为确定你是否使用.sym文件符号链接，检查[have_symlink](#) [502]系统变量的值，使用下面的语句：

    SHOW VARIABLES LIKE 'have_symlink';

为创建一个.sym文件符号链接，使用下面过程：

1.进入数据库目录：
    
    C:\> cd \path\to\datadir

在数据库目录中，创建一个命名为[mydb.sym](#)的文本文件，该文件包含路径名D:\data\mydb

**注意**
>到新数据库和表的路径应该是绝对的。如果你说明一个相对路径，地址将相对于[mydb.sym](#)。

之后，所有创建于数据库[mydb](#)的表创建在D:\data\mydb。

**注意**
>因为对支持[.sym](#)文件，对支持[mkling](#)的本地符号链接来说是多余的，不赞成在MYSQL5.6.9上使用[.sym](#)文件，并且对它们的支持将在将来的版本移除。

下面是使用在windows上使用[.sym](#)文件做数据库符号链接的限制。这些限制不应用于使用[mklink](#)的链接。

- 在MYSQL数据目录中，如果目录名字和数据库相同，符号链接不能使用。
- [--innodb\_file\_per\_table](#) [1754]选项不能使用。
- 如果你将[mysqld](#)作为服务运行，你不能映射驱动到一个使用符号链接的远程服务器。作为一个工作区，你可以使用全路径（\\servername\path\）。